---
title: "Instrumentos de An치lisis Urbano II - Trabajo Pr치ctico 01"
author: "Mat칤as Lince Marino"
date: "2023-08-05"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{=html}
<style>
.notion-link {
  display: inline-block;
  padding: 5px 10px;
  background-color: #f4f4f4;
  border: 1px solid #ccc;
  border-radius: 5px;
  text-decoration: none;
  color: #333;
  font-weight: bold;
  font-size: 14px;
}

.notion-icon {
  margin-left: 5px;
}
</style>
<hide>
```

## Introducci칩n

El presente trabajo pretende servir de ejercicio preparatorio de la tesis de la Maestr칤a de Econom칤a Urbana, cuyo objeto de an치lisis es "Mi Pieza", un programa de subsidios destinado al mejoramiento de vivienda por autoconstrucci칩n en barrios populares de Argentina.

La base de datos fue obtenida a partir de un relevamiento que estuvo a cargo del Centro de Investigaciones en Estad칤stica Aplicada (CINEA) de la Universidad Nacional de Tres de Febrero (UNTREF) en el marco de un proyecto financiado por el Banco Interamericano de Desarrollo. Este relevamiento fue utilizado para realizar una evaluaci칩n de impacto recientmente publicada, cuyos autores son el responsable de este Trabajo Pr치ctico y Claudia V치zquez. La misma se encuentra disponible en el siguiente [enlace](%22https://publications.iadb.org/publications/spanish/viewer/Impacto-de-los-programas-de-mejoramiento-de-vivienda-por-autoconstruccion-evidencia-para-barrios-populares-de-Argentina.pdf%22){target="_blank"}

```{r, results='asis'}
url <- "https://publications.iadb.org/publications/spanish/viewer/Impacto-de-los-programas-de-mejoramiento-de-vivienda-por-autoconstruccion-evidencia-para-barrios-populares-de-Argentina.pdf"
texto_marcador <- "Ver en Sitio Original"
html_code <- sprintf('<a href="%s" class="notion-link">%s <span class="notion-icon">游댕</span></a>', url, texto_marcador)
HTML(html_code)
```

## Pregunta a responder en el presente trabajo

Sobre la base de los hallazgos que surgieron de la evaluaci칩n de impacto mencionada, y con el objetivo de realizar reformulaciones de la pol칤tica, se pretende indagar acerca del efecto que tuvo la asignaci칩n de montos id칠nticos para todas las provincias del pa칤s, cuyos costos de construcci칩n son muy dis칤miles.

Para poder avanzar en la investigaci칩n, en una primera instancia ser치 necesario entender si hay suficiente informaci칩n disponible para dar respuesta a la pregunta. En esta l칤nea, la primera tarea ser치 procesar la base de manera de **entender qu칠 cantidad de mujeres seleccionadas (grupo de tratamiento) y no seleccionadas (grupo de control) hay en cada regi칩n**.

## Edici칩n de la base de datos para resoluci칩n de Trabajo Pr치ctico 01

La base de datos original contiene 3.083 observaciones y m치s de 190 variables. Debido a la pregunta de investigaci칩n, se buscar치 editar la base conforme la necesidad, de manera de trabajar con menor cantidad de informaci칩n.

A los fines de poder leer correctamente la base, se eliminaron manualmente las columnas con campos abiertos dado que se importaron con errores en los caracteres que dificultaron su lectura. Cabe aclarar que esos campos no eran de utilidad para la pregunta que se quiere responder en este este ejercicio y en el marco de la pregunta de investigaci칩n para la tesis, dado que responden a aspectos cualitativos del Programa.

### Presentaci칩n de la base

```{r}
basemipieza <- read.csv2("01-Data/MIPIEZA_BASE-FINAL-03.csv", encoding = "UTF-8", header = TRUE)
```

Observando la base editada manualmente y le칤da a trav칠s de la funci칩n "read.csv2", identificamos que tiene 3083 observaciones y 179 variables. Cabe aclarar que todas las variables deben ser interpretadas con un diccionario que fue provisto por la UNTREF. El significado de cada una de ellas ser치 detallado una vez que la base se encuentre editada para el presente ejercicio. Sin embargo, a modo de adelanto, visualizaremos su estructura:

```{r}
library(rmarkdown)
```

```{r}
paged_table(head(basemipieza, 10))
```

Como podemos observar, la mayor parte de las variables y de sus respuestas son num칠ricas y, sin la lectura del diccionario provisto por la UNTREF, su interpretaci칩n se dificulta. Para ello, deberemos hacer modificaciones a la base, conforme se desarrolla a continuaci칩n.

En una primera instancia se intent칩 visualizar el Excel que fue entregado como diccionario en el entorno del archivo y para ello se usaron funciones del paquete **readxl**. Sin embargo, la lectura resultaba algo engorrosa, por lo que se trabaj칩 manualmente sobre el Excel para generar un PDF de mejor lectura.

Se deja constancia del proceso a los fines de poder ver la mejora en la visualizaci칩n.

```{r}
library(readxl) #Instalamos paquete **readxl**
```

```{r}
ruta_archivo <- "01-Data/Diccionario Bases MI PIEZA (Entrevistada y Hogar).xlsx" #Incluimos ruta del archivo
diccionario <- read_excel(ruta_archivo, sheet = "Valores") #Leemos el archivo.
```

```{r}
paged_table(diccionario) #Visualizamos el archivo
```

Dada la dificultad de lectura que presenta, y tal como se mencion칩 anteriormente, se gener칩 el PDF y se lo carg칩 en el repositorio de GitHub El mismo se encuentra disponible en el siguiente enlace: <https:github.com/mlincemarino/mu124tp01/blob/main/MIPIEZA_Diccionario%20Bases%20-%20Entrevistada%20y%20Hogar.pdf>.

De esta manera, podremos consultar en el documento el significado de cada variable y de los valores en cualquier momento que sea necesario.

### Trabajo sobre la base

Dado que las variables que nos interesan y son de utilidad para responder la pregunta de investigaci칩n de la tesis es limitada, haremos una primera selecci칩n de aquellas que nos interesan.

```{r}
library(dplyr)
basemipieza_sel <- select(basemipieza, c("V3", "V43_OTR"), "V5":"V31", "Anos_barrio":"Meses_casa", "V47":"V57", "V71":"V77")
```

Para esta primera selecci칩n, tenemos 54 variables de inter칠s, que est치n orientadas a obtener informaci칩n acerca de:

-   **Provincia** de las mujeres entrevistadas.
-   **Condici칩n de la entrevistada** (seleccionada o no para recibir el beneficio), de manera de poder dividirlas en grupo de tratamiento y grupo de control.
-   **Estado de la vivienda** en base a preguntas sobre tipo de techo, paredes, piso, etc.
-   **Tipo de obra** elegida entre las que ofrece el Programa "Mi Pieza"
-   **Satisfacci칩n para con atributos de la vivienda** tales como convivencia, estado de los cerramientos, etc.

Antes de seguir, seguiremos modificando la base para agregarle una **variable que las agrupe por regi칩n**.

### Regiones - detalles

Se presentan las diferentes regiones de Argentina que se usar치n como referencia para el presente ejercicio:

-   **Nordeste**: Chaco, Formosa, Corrientes y Misiones.
-   **Cuyo**: San Luis, San Juan, Mendoza y La Rioja
-   **Noroeste**: Santiago del Estero, Salta, Jujuy, Tucum치n y Catamarca
-   **Regi칩n pampeana**: Ciudad Aut칩noma de Buenos Aires, La Pampa, Buenos Aires, C칩rdoba, Entre R칤os y Santa Fe
-   **Patagonia**: Neuqu칠n, Santa Cruz, Chubut, R칤o Negro y Tierra del Fuego.

A continuaci칩n, introduciremos las modificaciones necesarias sobre la variable "V3", que es "provincia" (ver diccionario).

```{r}
basemipieza_sel$V3 <- as.integer(basemipieza_sel$V3)
```

```{r}
basemipieza_sel <- mutate(basemipieza_sel, provincia=case_when(
    V3 == 1 ~ "Buenos Aires", 
    V3 == 2 ~ "Ciudad Aut칩noma de Buenos Aires",
    V3 == 3 ~ "Catamarca",
    V3 == 4 ~ "Chaco",
    V3 == 5 ~ "Chubut",
    V3 == 6 ~ "C칩rdoba",
    V3 == 7 ~ "Corrientes",
    V3 == 8 ~ "Entre R칤os",
    V3 == 9 ~ "Formosa",
    V3 == 10 ~ "Jujuy",
    V3 == 11 ~ "La Pampa",
    V3 == 12 ~ "La Rioja",
    V3 == 13 ~ "Mendoza",
    V3 == 14 ~ "Misiones",
    V3 == 15 ~ "Neuqu칠n",
    V3 == 16 ~ "R칤o Negro",
    V3 == 17 ~ "Salta",
    V3 == 18 ~ "San Juan",
    V3 == 19 ~ "San Luis",
    V3 == 20 ~ "Santa Cruz",
    V3 == 21 ~ "Santa Fe",
    V3 == 22 ~ "Santiago del Estero",
    V3 == 23 ~ "Tierra del Fuego",
    V3 == 24 ~ "Tucum치n"))
```

Veamos ahora un resumen de la cantidad de observacions por provincia con las funciones **summarise** y **group_by**.

```{r}
basemipieza_prov <- basemipieza_sel %>%
  group_by(provincia) %>%
  summarise(cantidad_prov=n())
```

Ahora veremos la cantidad de valores por provincia de una manera resumida:

```{r}
paged_table(basemipieza_prov)
```

Como podemos observar, la mayor parte de los registros est치n en la provincia de Buenos Aires, lo que tiene sentido si se tiene en cuenta que la mayor parte de barrios populares se encuentran en dicha provincia, conforme los datos brindados por el Observatorio de Barrios Populares (disponible en: <https://lookerstudio.google.com/u/0/reporting/0a127285-4dd0-43b2-b7b2-98390bfd567f/page/klATC>).

Viendo que esto funciona, ahora agregaremos una variable que sea "regi칩n" sobre la base "basemipieza_sel".

```{r}
basemipieza_sel <- mutate(basemipieza_sel, regi칩n=case_when(
    provincia == "Buenos Aires" ~ "Pampeana",
    provincia == "Ciudad Aut칩noma de Buenos Aires" ~ "Pampeana",
    provincia == "Catamarca" ~ "Noroeste",
    provincia == "Chaco" ~ "Nordeste",
    provincia == "Chubut" ~ "Patagonia",
    provincia == "C칩rdoba" ~ "Pampeana",
    provincia == "Corrientes" ~ "Nordeste",
    provincia == "Entre R칤os" ~ "Pampeana",
    provincia == "Formosa" ~ "Nordeste",
    provincia == "Jujuy" ~ "Noroeste",
    provincia == "La Pampa" ~ "Pampeana",
    provincia == "La Rioja" ~ "Cuyo",
    provincia == "Mendoza" ~ "Cuyo",
    provincia == "Misiones" ~ "Nordeste",
    provincia == "Neuqu칠n" ~ "Pampeana",
    provincia == "R칤o Negro" ~ "Patagonia",
    provincia == "Salta" ~ "Noroeste",
    provincia == "San Juan" ~ "Cuyo",
    provincia == "San Luis" ~ "Cuyo",
    provincia == "Santa Cruz" ~ "Patagonia",
    provincia == "Santa Fe" ~ "Pampeana",
    provincia == "Santiago del Estero" ~ "Noroeste",
    provincia == "Tierra del Fuego" ~ "Nordeste",
    provincia == "Tucum치n" ~ "Noroeste"))
```

Tambi칠n modificaremos la variable "V5" (Seleccionada; ver diccionario) para que adquiera el valor "S칤" o "No" seg칰n si fueron o no seleccionadas (1=S칤, 2=No).

```{r}
basemipieza_sel <- mutate(basemipieza_sel, V5=case_when(
    V5 == 1 ~ "S칤",
    V5 == 2 ~ "No"))
```

Agregada la columna y modificada la variable "V5", veremos cu치ntos valores tenemos por regi칩n y la participaci칩n que cada una tiene sobre el total. Adem치s, la cantidad de mujeres seleccionadas (grupo de tratamiento) y no seleccionadas (grupo de control) en cada una, adem치s de sus porcentajes:

```{r}
basemipieza_prov <- basemipieza_sel %>%
  group_by(regi칩n) %>%
  summarise(cantidad_enc=n(),porcentaje_reg=round((n()/nrow(basemipieza_sel)*100), 2),cantidad_trat=sum(V5=="S칤"), cantidad_control=sum(V5=="No"), porcentaje_trat=round(cantidad_trat/(cantidad_trat+cantidad_control)*100,2), porcentaje_control=round(cantidad_control/(cantidad_trat+cantidad_control)*100,2))
```

porcentaje_reg=round((n()/nrow(basemipieza_sel)\*100), 2)

Ahora veremos la cantidad de valores por provincia de una manera resumida:

```{r}
paged_table(basemipieza_prov)
```

## Primeras conclusiones sobre el trabajo realizado

Debido a que la pregunta que se busca responder est치 relacionada con la regi칩n en la que residen las personas relevadas, una pregunta importante ser치 entender si hay suficiente N en cada regi칩n tanto de mujeres beneficiarias como no beneficiaras y si est치n relativamente balanceadas.

**Las regiones "Cuyo" y "Patagonia" tienen la doble caracter칤stica de tener pocas mujeres encuestadas y un desbalance entre el grupo de tratamiento y el grupo de control**. En el caso de Cuyo, hay solo 49 mujeres encuestadas, de las cuales el 38,78% responden al grupo de tratamiento. Para la Patagonia, la cantidad de mujeres encuestadas es de 44 y solo un 29,55% de las mismas forman parte del grupo de tratamiento.

**En las restantes regiones hay un mayor balance**, teniendo diferencias menores a los 6 puntos porcentuales entre grupo de tratamiento y grupo de control.

Con los datos obtenidos, podremos luego realizar los ejercicios correspondientes para ver si tienen potencia estad칤stica y si con los mismos es posible responder la pregunta de investigaci칩n de tesis.
