---
title: "Instrumentos de An谩lisis Urbano II - Trabajo Pr谩ctico 01"
author: "Mat铆as Lince Marino"
date: "2023-08-05"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{=html}
<style>
.notion-link {
  display: inline-block;
  padding: 5px 10px;
  background-color: #f4f4f4;
  border: 1px solid #ccc;
  border-radius: 5px;
  text-decoration: none;
  color: #333;
  font-weight: bold;
  font-size: 14px;
}

.notion-icon {
  margin-left: 5px;
}
</style>
<hide>
```

## Introducci贸n

El presente trabajo pretende servir de ejercicio preparatorio de la tesis de la Maestr铆a de Econom铆a Urbana, cuyo objeto de an谩lisis es "Mi Pieza", un programa de subsidios destinado al mejoramiento de vivienda por autoconstrucci贸n en barrios populares de Argentina.

La base de datos fue obtenida a partir de un relevamiento que estuvo a cargo del Centro de Investigaciones en Estad铆stica Aplicada (CINEA) de la Universidad Nacional de Tres de Febrero (UNTREF) en el marco de un proyecto financiado por el Banco Interamericano de Desarrollo. Este relevamiento fue utilizado para realizar una evaluaci贸n de impacto recientmente publicada, cuyos autores son el responsable de este Trabajo Pr谩ctico y Claudia V谩zquez. La misma se encuentra disponible en la web.  

```{r, echo = FALSE}
library(htmltools)
```

```{r, echo = FALSE}
url <- "https://publications.iadb.org/publications/spanish/viewer/Impacto-de-los-programas-de-mejoramiento-de-vivienda-por-autoconstruccion-evidencia-para-barrios-populares-de-Argentina.pdf"
texto_marcador <- "Banco Interamericano de Desarrollo - Impacto de los programas de mejoramiento de vivienda por autoconstrucci贸n: evidencia para barrios populares de Argentina"
html_code <- sprintf('<a href="%s" class="notion-link">%s <span class="notion-icon"></span></a>', url, texto_marcador)
HTML(html_code)
```
**Aclaraci贸n**: a los fines de mejorar la est茅tica, se ocult贸 el chunk utilizado, que implic贸 activar la librer铆a "htmltools" y usar la funci贸n strintif con la utilizaci贸n de la clase "notion-link", en un intento no del todo logrado de imitar la est茅tica de previsualizaci贸n de URL que tiene dicha aplicaci贸n. Seguir谩 explor谩ndose c贸mo hacerlo para lograr una mejor visualizaci贸n del documento. 

## Pregunta a responder en el presente trabajo

Sobre la base de los hallazgos que surgieron de la evaluaci贸n de impacto mencionada, y con el objetivo de realizar reformulaciones de la pol铆tica, se pretende indagar acerca del efecto que tuvo la asignaci贸n de montos id茅nticos para todas las provincias del pa铆s, cuyos costos de construcci贸n son muy dis铆miles.

Para poder avanzar en la investigaci贸n, en una primera instancia ser谩 necesario entender si hay suficiente informaci贸n disponible para dar respuesta a la pregunta. En esta l铆nea, la primera tarea ser谩 procesar la base de manera de **entender qu茅 cantidad de mujeres seleccionadas (grupo de tratamiento) y no seleccionadas (grupo de control) hay en cada regi贸n**.

## Edici贸n de la base de datos para resoluci贸n de Trabajo Pr谩ctico 01

La base de datos original contiene 3.083 observaciones y m谩s de 190 variables. Debido a la pregunta de investigaci贸n, se buscar谩 editar la base conforme la necesidad, de manera de trabajar con menor cantidad de informaci贸n.

A los fines de poder leer correctamente la base, se eliminaron manualmente las columnas con campos abiertos dado que se importaron con errores en los caracteres que dificultaron su lectura. Cabe aclarar que esos campos no eran de utilidad para la pregunta que se quiere responder en este este ejercicio y en el marco de la pregunta de investigaci贸n para la tesis, dado que responden a aspectos cualitativos del Programa.

### Presentaci贸n de la base

```{r}
basemipieza <- read.csv2("01-Data/MIPIEZA_BASE-FINAL-03.csv", encoding = "UTF-8", header = TRUE) #Ac谩 leemos el csv. 
```

Observando la base editada manualmente y le铆da a trav茅s de la funci贸n "read.csv2", identificamos que tiene 3083 observaciones y 178 variables. Cabe aclarar que todas las variables deben ser interpretadas con un diccionario que fue provisto por la UNTREF. El significado de cada una de ellas ser谩 detallado una vez que la base se encuentre editada para el presente ejercicio. Sin embargo, a modo de adelanto, visualizaremos su estructura:

```{r, echo = FALSE}
library(rmarkdown)
```

```{r}
paged_table(head(basemipieza, 10)) #Usamos la funci贸n "paged_table" para lograr una previsualizaci贸n de la base. Previamente activamos la librer铆a "rmarkdown" pero ocultamos el chunk dado que arrojaba otras l铆neas en el HTML que eran innecesarias.  
```

Como podemos observar, la mayor parte de las variables y de sus respuestas son num茅ricas y, sin la lectura del diccionario provisto por la UNTREF, su interpretaci贸n se dificulta. Para ello, deberemos hacer modificaciones a la base, conforme se desarrolla a continuaci贸n.

En una primera instancia se intent贸 visualizar el Excel que fue entregado como diccionario en el entorno del archivo y para ello se usaron funciones del paquete **readxl**. Sin embargo, la lectura resultaba algo engorrosa, por lo que se trabaj贸 manualmente sobre el Excel para generar un PDF de mejor lectura.

Se deja constancia del proceso a los fines de poder ver la mejora en la visualizaci贸n.

```{r}
library(readxl) #Instalamos paquete "readxl".
```

```{r}
ruta_archivo <- "01-Data/Diccionario Bases MI PIEZA (Entrevistada y Hogar).xlsx" #Incluimos ruta del archivo.
diccionario <- read_excel(ruta_archivo, sheet = "Valores") #Leemos el archivo.
```

```{r}
paged_table(diccionario) #Visualizamos el archivo con la funci贸n "paged_table". 
```

Dada la dificultad de lectura que presenta, y tal como se mencion贸 anteriormente, se gener贸 el PDF y se lo carg贸 en el repositorio de GitHub El mismo se encuentra disponible en el siguiente enlace:


```{r, echo = FALSE}
urldiccionario <- "https:github.com/mlincemarino/mu124tp01/blob/main/MIPIEZA_Diccionario%20Bases%20-%20Entrevistada%20y%20Hogar.pdf"
texto_marcador02 <- "Diccionario de base de datos de Mi Pieza"
html_code <- sprintf('<a href="%s" class="notion-link">%s <span class="notion-icon"></span></a>', urldiccionario, texto_marcador02)
HTML(html_code)
```


De esta manera, podremos consultar en el documento el significado de cada variable y de los valores en cualquier momento que sea necesario.

### Trabajo sobre la base

Dado que las variables que nos interesan y son de utilidad para responder la pregunta de investigaci贸n de la tesis es limitada, haremos una primera selecci贸n de aquellas que nos interesan.

```{r}
library(dplyr) #Activamos la librer铆a "dplyr"
```

```{r}
basemipieza_sel <- select(basemipieza, c("V3", "V43_OTR"), "V5":"V31", "Anos_barrio":"Meses_casa", "V47":"V57", "V71":"V77") #Seleccionamos las variables de inter茅s.
```

Para esta primera selecci贸n, tenemos 54 variables de inter茅s, que est谩n orientadas a obtener informaci贸n acerca de:

-   **Provincia** de las mujeres entrevistadas.
-   **Condici贸n de la entrevistada** (seleccionada o no para recibir el beneficio), de manera de poder dividirlas en grupo de tratamiento y grupo de control.
-   **Estado de la vivienda** en base a preguntas sobre tipo de techo, paredes, piso, etc.
-   **Tipo de obra** elegida entre las que ofrece el Programa "Mi Pieza"
-   **Satisfacci贸n para con atributos de la vivienda** tales como convivencia, estado de los cerramientos, etc.

Antes de seguir, seguiremos modificando la base para agregarle una **variable que las agrupe por regi贸n**.

### Regiones - detalles

Se presentan las diferentes regiones de Argentina que se usar谩n como referencia para el presente ejercicio:

-   **Nordeste**: Chaco, Formosa, Corrientes y Misiones.
-   **Cuyo**: San Luis, San Juan, Mendoza y La Rioja
-   **Noroeste**: Santiago del Estero, Salta, Jujuy, Tucum谩n y Catamarca
-   **Regi贸n pampeana**: Ciudad Aut贸noma de Buenos Aires, La Pampa, Buenos Aires, C贸rdoba, Entre R铆os y Santa Fe
-   **Patagonia**: Neuqu茅n, Santa Cruz, Chubut, R铆o Negro y Tierra del Fuego.

A continuaci贸n, introduciremos las modificaciones necesarias sobre la variable "V3", que es "provincia" (ver diccionario).

```{r}
basemipieza_sel$V3 <- as.integer(basemipieza_sel$V3) #Convertimos a integer.
```

```{r}
#Cambiamos los nombres de las columnas
basemipieza_sel <- mutate(basemipieza_sel, provincia=case_when(
    V3 == 1 ~ "Buenos Aires", 
    V3 == 2 ~ "Ciudad Aut贸noma de Buenos Aires",
    V3 == 3 ~ "Catamarca",
    V3 == 4 ~ "Chaco",
    V3 == 5 ~ "Chubut",
    V3 == 6 ~ "C贸rdoba",
    V3 == 7 ~ "Corrientes",
    V3 == 8 ~ "Entre R铆os",
    V3 == 9 ~ "Formosa",
    V3 == 10 ~ "Jujuy",
    V3 == 11 ~ "La Pampa",
    V3 == 12 ~ "La Rioja",
    V3 == 13 ~ "Mendoza",
    V3 == 14 ~ "Misiones",
    V3 == 15 ~ "Neuqu茅n",
    V3 == 16 ~ "R铆o Negro",
    V3 == 17 ~ "Salta",
    V3 == 18 ~ "San Juan",
    V3 == 19 ~ "San Luis",
    V3 == 20 ~ "Santa Cruz",
    V3 == 21 ~ "Santa Fe",
    V3 == 22 ~ "Santiago del Estero",
    V3 == 23 ~ "Tierra del Fuego",
    V3 == 24 ~ "Tucum谩n"))
```

Veamos ahora un resumen de la cantidad de observacions por provincia con las funciones **summarise** y **group_by**.

```{r}
#Agrupamos por provincia y agregamos el dato de la cantidad de observaciones por cada una. 
basemipieza_prov <- basemipieza_sel %>%
  group_by(provincia) %>%
  summarise(cantidad_prov=n())
```

Ahora veremos la cantidad de valores por provincia de una manera resumida:

```{r}
paged_table(basemipieza_prov) #Visualizamos la base con la funci贸n "paged_table". 
```

```{r}
knitr::kable(basemipieza_prov, format = "pipe", table.attr = 'style="width:100%;"') #Otra forma de visualizar con la funci贸n "kable", que permite leer todo el listado de corrido.
```

Como podemos observar, la mayor parte de los registros est谩n en la provincia de Buenos Aires, lo que tiene sentido si se tiene en cuenta que la mayor parte de barrios populares se encuentran en dicha provincia, conforme los datos brindados por el Observatorio de Barrios Populares (disponible en: <https://lookerstudio.google.com/u/0/reporting/0a127285-4dd0-43b2-b7b2-98390bfd567f/page/klATC>).

Viendo que esto funciona, ahora agregaremos una variable que sea "regi贸n" sobre la base "basemipieza_sel".

```{r}
#Agregamos nueva variable (regi贸n) seg煤n valor de la variable "provincia". Importante: este proceso se deber铆a poder automatizar. Resta explorar c贸mo hacerlo. 
basemipieza_sel <- mutate(basemipieza_sel, regi贸n=case_when(
    provincia == "Buenos Aires" ~ "Pampeana",
    provincia == "Ciudad Aut贸noma de Buenos Aires" ~ "Pampeana",
    provincia == "Catamarca" ~ "Noroeste",
    provincia == "Chaco" ~ "Nordeste",
    provincia == "Chubut" ~ "Patagonia",
    provincia == "C贸rdoba" ~ "Pampeana",
    provincia == "Corrientes" ~ "Nordeste",
    provincia == "Entre R铆os" ~ "Pampeana",
    provincia == "Formosa" ~ "Nordeste",
    provincia == "Jujuy" ~ "Noroeste",
    provincia == "La Pampa" ~ "Pampeana",
    provincia == "La Rioja" ~ "Cuyo",
    provincia == "Mendoza" ~ "Cuyo",
    provincia == "Misiones" ~ "Nordeste",
    provincia == "Neuqu茅n" ~ "Pampeana",
    provincia == "R铆o Negro" ~ "Patagonia",
    provincia == "Salta" ~ "Noroeste",
    provincia == "San Juan" ~ "Cuyo",
    provincia == "San Luis" ~ "Cuyo",
    provincia == "Santa Cruz" ~ "Patagonia",
    provincia == "Santa Fe" ~ "Pampeana",
    provincia == "Santiago del Estero" ~ "Noroeste",
    provincia == "Tierra del Fuego" ~ "Nordeste",
    provincia == "Tucum谩n" ~ "Noroeste"))
```

Tambi茅n modificaremos la variable "V5" (Seleccionada; ver diccionario) para que adquiera el valor "S铆" o "No" seg煤n si fueron o no seleccionadas (1=S铆, 2=No).

```{r}
#Modificamos el valor de la variable V5 para facilitar su lectura. 
basemipieza_sel <- mutate(basemipieza_sel, V5=case_when(
    V5 == 1 ~ "S铆",
    V5 == 2 ~ "No"))
```

Agregada la columna y modificada la variable "V5", veremos cu谩ntos valores tenemos por regi贸n y la participaci贸n que cada una tiene sobre el total. Adem谩s, la cantidad de mujeres seleccionadas (grupo de tratamiento) y no seleccionadas (grupo de control) en cada una, adem谩s de sus porcentajes:

```{r}
#Agrupamos por regi贸n y agregamos variables que permitan visualizar qu茅 cantidad y porcentaje de mujeres en grupo de tratamiento y en grupo de control hay en cada regi贸n. 
basemipieza_prov <- basemipieza_sel %>%
  group_by(regi贸n) %>%
  summarise(cantidad_enc=n(),porcentaje_reg=round((n()/nrow(basemipieza_sel)*100), 2),cantidad_trat=sum(V5=="S铆"), cantidad_control=sum(V5=="No"), porcentaje_trat=round(cantidad_trat/(cantidad_trat+cantidad_control)*100,2), porcentaje_control=round(cantidad_control/(cantidad_trat+cantidad_control)*100,2))
```

Ahora veremos la cantidad de valores por provincia de una manera resumida:

```{r}
knitr::kable(basemipieza_prov, format = "pipe", table.attr = 'style="width:100%;"') #Usamos otra forma de visualizar a partir de la funci贸n "kable", que en este caso resulta m谩s conveniente porque permite ver todos los valores en una misma p谩gina, lo que facilita la comparaci贸n. 
```

## Primeras conclusiones sobre el trabajo realizado

Debido a que la pregunta que se busca responder est谩 relacionada con la regi贸n en la que residen las personas relevadas, una pregunta importante ser谩 entender si hay suficiente N en cada regi贸n tanto de mujeres beneficiarias como no beneficiaras y si est谩n relativamente balanceadas.

**Las regiones "Cuyo" y "Patagonia" tienen la doble caracter铆stica de tener pocas mujeres encuestadas y un desbalance entre el grupo de tratamiento y el grupo de control**. En el caso de Cuyo, hay solo 49 mujeres encuestadas, de las cuales el 38,78% responden al grupo de tratamiento. Para la Patagonia, la cantidad de mujeres encuestadas es de 44 y solo un 29,55% de las mismas forman parte del grupo de tratamiento.

**En las restantes regiones hay un mayor balance**, teniendo diferencias menores a los 6 puntos porcentuales entre grupo de tratamiento y grupo de control.

Con los datos obtenidos, podremos luego realizar los ejercicios correspondientes para ver si tienen potencia estad铆stica y si con los mismos es posible responder la pregunta de investigaci贸n de tesis.
